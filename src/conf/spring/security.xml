<?xml version="1.0" encoding="UTF-8"?>

<!-- $Id$ -->

<beans xmlns="http://www.springframework.org/schema/beans" 
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

		<bean id="acegiFilter" class="org.springframework.security.util.FilterChainProxy">
		<property name="filterInvocationDefinitionSource"><value>
			PATTERN_TYPE_APACHE_ANT
			/**=httpSessionContextIntegrationFilter,logoutFilter,authenticationProcessingFilter,anonymousProcessingFilter,exceptionTranslationFilter,filterSecurityInterceptor
		</value></property>
	</bean>
	
	<bean id="httpSessionContextIntegrationFilter" class="org.springframework.security.context.HttpSessionContextIntegrationFilter">
	
	</bean>
	
	<bean id="authenticationProcessingFilter" class="org.springframework.security.ui.webapp.AuthenticationProcessingFilter">
		<property name="authenticationManager" ref="authenticationManager"/>
		<property name="authenticationFailureUrl" value="/enter?loginAttempted=true"/>
		<property name="defaultTargetUrl" value="/dashboard"/>
		<property name="filterProcessesUrl" value="/enter/process"/>
	</bean>
	
	<bean id="authenticationProcessingFilterEntryPoint" class="org.springframework.security.ui.webapp.AuthenticationProcessingFilterEntryPoint">
		<property name="loginFormUrl" value="/enter"/>
	</bean>
	
	<bean id="logoutFilter" class="org.springframework.security.ui.logout.LogoutFilter">
		<constructor-arg value="/"/>
		<constructor-arg><bean class="org.springframework.security.ui.logout.SecurityContextLogoutHandler"/></constructor-arg>
		<property name="filterProcessesUrl" value="/exit"/>
	</bean>
	
	<bean id="exceptionTranslationFilter" class="org.springframework.security.ui.ExceptionTranslationFilter">
		<property name="authenticationEntryPoint" ref="authenticationProcessingFilterEntryPoint"/>
		<property name="accessDeniedHandler">
			<bean class="org.springframework.security.ui.AccessDeniedHandlerImpl">
				<property name="errorPage" value="/WEB-INF/jsp/security/accessDenied.jsp"/>
			</bean>
		</property>
	</bean>
	
	<bean id="authenticationManager" class="org.springframework.security.providers.ProviderManager">
		<property name="providers"><list>
			<ref local="daoAuthenticationProvider"/>
			<ref local="anonymousAuthenticationProvider"/>
		</list></property>
	</bean>
	
	<bean id="daoAuthenticationProvider" class="org.springframework.security.providers.dao.DaoAuthenticationProvider">
		<property name="userDetailsService" ref="daoUserDetailsService"/>
	</bean>
	
	<bean id="daoUserDetailsService" class="edu.uoregon.cs.presenter.security.DaoUserDetailsService">
		<property name="dao" ref="dao"/>
	</bean>
	
	<bean id="anonymousProcessingFilter" class="org.springframework.security.providers.anonymous.AnonymousProcessingFilter">
		<property name="key" value="anonymous"/>
		<property name="userAttribute" value="anonymous,ROLE_ANONYMOUS"/>
	</bean>

	<bean id="anonymousAuthenticationProvider" class="org.springframework.security.providers.anonymous.AnonymousAuthenticationProvider">
		<property name="key" value="anonymous"/>
	</bean>
	
	<bean id="accessDecisionManager" class="org.springframework.security.vote.AffirmativeBased">
		<property name="decisionVoters"><list>
			<bean class="org.springframework.security.vote.AuthenticatedVoter"/>
			<bean class="org.springframework.security.vote.RoleVoter"/>
		</list></property>
	</bean>
	
	<bean id="filterSecurityInterceptor" class="org.springframework.security.intercept.web.FilterSecurityInterceptor">
		<property name="authenticationManager" ref="authenticationManager"/>
		<property name="accessDecisionManager" ref="accessDecisionManager"/>
		<property name="objectDefinitionSource"><value>
			PATTERN_TYPE_APACHE_ANT
			/=IS_AUTHENTICATED_ANONYMOUSLY
			/favicon.ico=IS_AUTHENTICATED_ANONYMOUSLY
			/public/**=IS_AUTHENTICATED_ANONYMOUSLY
			/static/**=IS_AUTHENTICATED_ANONYMOUSLY
			/enter**=IS_AUTHENTICATED_ANONYMOUSLY
			/exit=IS_AUTHENTICATED_ANONYMOUSLY
			/welcome**=IS_AUTHENTICATED_ANONYMOUSLY
			/ubiquitous/**=IS_AUTHENTICATED_ANONYMOUSLY
			/instructor/**=ROLE_INSTRUCTOR,ROLE_ADMIN
			/admin/**=ROLE_ADMIN
			/**=ROLE_STUDENT,ROLE_INSTRUCTOR,ROLE_ADMIN
		</value></property>
	</bean>
</beans>