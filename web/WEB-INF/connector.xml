<?xml version="1.0" encoding="UTF-8"?>

<!-- $Id$ -->

<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation=" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">
	<bean id="irm" abstract="true" class="edu.uoregon.cs.p2presenter.UriPatternRequestMatcher">
		<property name="parameterNames" value="interactivityId"/>
	</bean>
	
	<bean id="connectionManager" class="edu.uoregon.cs.p2presenter.ConnectionManager">
		<property name="requestHandlerMapping.uriMappedHandlers"><map>
			<entry key="/login"><bean class="edu.uoregon.cs.p2presenter.authentication.LoginRequestHandler"/></entry>
			<entry key="/logout"><bean class="edu.uoregon.cs.p2presenter.authentication.LogoutRequestHandler"/></entry>
		</map></property>
		<property name="requestHandlerMapping.matcherMappedHandlers"><map>
			<entry>
				<key><bean parent="irm"><property name="pattern" value="/interactivity/(\d+)/get"/></bean></key>
				<bean class="edu.uoregon.cs.p2presenter.interactivity.server.GetInteractivityRequestHandler">
					<property name="activeInteractivityController" ref="activeInteractivityController"/>
				</bean>
			</entry>
			<entry>
				<key><bean parent="irm"><property name="pattern" value="/interactivity/(\d+)/join"/></bean></key>
				<bean class="edu.uoregon.cs.p2presenter.interactivity.JoinInteractivityRequestHandler">
					<property name="activeInteractivityController" ref="activeInteractivityController"/>
				</bean>
			</entry>
			<entry>
				<key><bean parent="irm"><property name="pattern" value="/interactivity/(\d+)/controller"/></bean></key>
				<bean class="edu.uoregon.cs.p2presenter.interactivity.ProxyInteractivityRequestHandler">
					<property name="activeInteractivityController" ref="activeInteractivityController"/>
					<property name="connectionManager" ref="connectionManager"/>
				</bean>
			</entry>
			<entry>
				<key><bean parent="irm"><property name="pattern" value="/interactivity/(\d+)/admin"/></bean></key>
				<bean class="edu.uoregon.cs.p2presenter.interactivity.InteractivityAdminRequestHandler">
					<property name="dao" ref="dao"/>
					<property name="activeInteractivityController" ref="activeInteractivityController"/>
				</bean>
			</entry>
		</map></property>
		<property name="requestHandlerMapping.uriMappedFilters"><map>
			<entry key="/**"><bean class="edu.uoregon.cs.p2presenter.authentication.SecurityContextIntegrationFilter"/></entry>
		</map></property>
	</bean>
	
	<bean id="portListener" class="edu.uoregon.cs.p2presenter.server.P2PresenterServerPortListener" init-method="init">
		<property name="portNumber" value="9000"/>
		<property name="connectionManager" ref="connectionManager"/>
	</bean>
</beans>