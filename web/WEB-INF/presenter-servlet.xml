<?xml version="1.0" encoding="UTF-8"?> 

<!-- $Id$ -->

<beans
	xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:r="http://ry1.org/schema/routes"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
		http://ry1.org/schema/routes http://ry1.org/schema/routes-1.0.xsd">
	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
	</bean>
	
	<bean id="handlerMapping" class="org.ry1.springframework.web.routes.RouteHandlerMapping">
		<property name="routes">
			<list>
				<r:connect
					r:pattern="/"
					r:name="home"
					controller="home"/>
				
				<r:connect
					r:pattern="/dashboard"
					r:name="dashboard"
					controller="dashboard"
					action="index"/>
				
				<r:connect controller="newUser">/welcome</r:connect>
				<r:connect controller="loginForm">/enter</r:connect>
				<r:connect
					r:pattern="/exit"
					r:name="logOut"/>
				
				<r:connect r:name="editProfile" controller="profile">/profile</r:connect>
				
				<r:connect controller="studentSubject" action="index">/student/subjects/</r:connect>
				<r:connect controller="studentSubject" action="show">/student/subjects/:subject</r:connect>
				<r:connect controller="studentCourse" action="index">/student/courses/:action</r:connect>
				<r:connect controller="studentCourse" action="show">/student/courses/:id/:action</r:connect>
				
				<r:connect controller="lecture">/lectures/:lectureId</r:connect>
				<r:connect controller="lectureSession">/lectures/:lectureId/watch</r:connect>
				<r:connect controller="lectureSession">/watch/:lectureSessionId</r:connect>
				<r:connect controller="acceptFreeformSubmission">/watch/:lectureSessionId/submit/freeform</r:connect>
				<r:connect controller="slideImage">/slides/:slideId.png</r:connect>
				<r:connect controller="inkImage">/ink/slides/:slideSessionId/:inkIndex.png</r:connect>
				<r:connect controller="whiteboardImage">/ink/whiteboards/:whiteboardId/:inkIndex.png</r:connect>
				<r:connect controller="createCourse">/instructor/courses/create</r:connect>
				
				<r:connect controller="instructorCourse" action="index">/instructor/courses/:action</r:connect>
				<r:connect controller="instructorCourse" action="show">/instructor/courses/:id/:action</r:connect>
				
				<r:connect controller="lectureCreate">/instructor/courses/:courseId/createLecture</r:connect>
				<r:connect controller="instructorLecture" action="show">/instructor/lectures/:id/:action</r:connect>
				<r:connect controller="newSlide">/instructor/lectures/:lectureId/slides/create</r:connect>
				<r:connect controller="simpleEditSlide">/instructor/lectures/:lectureId/slides/:slideId</r:connect>
				
				<r:connect controller="instructorLectureSession" action="show">/instructor/lectureSession/:id/:action</r:connect>
				
				<r:connect controller="adminDashboard">/admin/</r:connect>
				<r:connect controller="simpleAddRole">/admin/addRole</r:connect>
				<r:connect controller="simpleRemoveRole">/admin/removeRole</r:connect>
			</list>
		</property>
		<!-- <property name="urlMap"><map>
			<entry key="/participate" value="homeController"/>
			
			<r:connect controller="upSoapServer">/ubiquitous/lib/soap_server.php</r:connect>
			<r:connect controller="upHttpTransfers">/ubiquitous/lib/http_transfers.php</r:connect>
		</map></property>-->
		
		<property name="interceptors"><list>
			<bean class="org.ry1.springframework.web.context.request.FlashModelBindingInterceptor">
				<property name="flashMap" ref="flashMap"/>
			</bean>
			<bean class="edu.uoregon.cs.presenter.web.controller.PersonBindingInterceptor">
				<property name="dao" ref="dao"/>
			</bean>
		</list></property>
	</bean>
	
	<!-- the static controller is mapped without the interceptors -->
	<bean class="org.springframework.web.servlet.handler.SimpleUrlHandlerMapping">
		<property name="urlMap"><map>
			<entry key="/static/**" value-ref="staticController"/>
		</map></property>
	</bean>
	
	<bean id="flashMap" class="org.ry1.springframework.web.context.request.FlashMap"/>
	
	<bean id="abstractPresenterController" abstract="true">
		<property name="dao" ref="dao"/>
		<property name="flashMap" ref="flashMap"/>
	</bean>
	
	<bean id="homeController" class="org.springframework.web.servlet.mvc.ParameterizableViewController">
		<property name="viewName" value="home"/>
	</bean>
	
	<bean id="newUserController" class="edu.uoregon.cs.presenter.web.controller.NewUserController">
		<property name="dao" ref="dao"/>
		<property name="formView" value="security/newUser"/>
		<property name="successView" value="redirect:/"/>
	</bean>
	
	<bean id="loginFormController" class="org.springframework.web.servlet.mvc.ParameterizableViewController">
		<property name="viewName" value="security/login"/>
	</bean>
	
	<bean id="profileController" class="edu.uoregon.cs.presenter.web.controller.ProfileEditorController" parent="abstractPresenterController">
		<property name="formView" value="profile/edit"/>
		<property name="successView" value="redirect:/courses"/>
	</bean>
	
	<bean id="dashboardController" class="org.p2presenter.web.DashboardController" parent="abstractPresenterController">
		<property name="activeLectureController" ref="activeLectureController"/>
	</bean>
	
	<bean id="studentCourseController" class="org.p2presenter.web.student.StudentCourseController" parent="abstractPresenterController">
		<property name="activeLectureController" ref="activeLectureController"/>
	</bean>
	
	<bean id="studentSubjectController" class="org.p2presenter.web.student.StudentSubjectController" parent="abstractPresenterController">
	
	</bean>
	
	<bean id="instructorCourseController" class="org.p2presenter.web.instructor.InstructorCourseController" parent="abstractPresenterController">
	</bean>
	
	<bean id="instructorLectureController" class="org.p2presenter.web.instructor.InstructorLectureController" parent="abstractPresenterController">
		<property name="viewName" value="instructor/lecture/details"/>
		<property name="activeLectureController" ref="activeLectureController"/>
	</bean>
	
	<bean id="lectureSessionController" class="edu.uoregon.cs.presenter.web.controller.LectureSessionController" parent="abstractPresenterController">
		<property name="viewName" value="lecture/active"/>
		<property name="activeLectureController" ref="activeLectureController"/>
	</bean>
	
	<bean id="acceptFreeformSubmissionController" class="edu.uoregon.cs.presenter.web.controller.submission.AcceptFreeformSubmissionController">
		<property name="dao" ref="dao"/>
	</bean>
	
	<bean id="lectureCreateController" class="edu.uoregon.cs.presenter.web.controller.instructor.LectureCreateController" parent="abstractPresenterController">
		<property name="formView" value="instructor/lecture/create"/>
		<property name="successView" value="redirect:/courses"/>
	</bean>
	
	<bean id="newSlideController" class="edu.uoregon.cs.presenter.web.controller.instructor.NewSlideController" parent="abstractPresenterController">
		<property name="fileController" ref="fileController"/>
		<property name="successView" value="redirect:/courses"/>
	</bean>
	
	<bean id="simpleEditSlideController" class="edu.uoregon.cs.presenter.web.controller.instructor.SimpleEditSlideController" parent="abstractPresenterController">
		<property name="formView" value="instructor/lecture/editSlide"/>
		<property name="successView" value="redirect:/courses"/>
	</bean>
	
	<bean id="instructorLectureSessionController" class="org.p2presenter.web.instructor.InstructorLectureSessionController" parent="abstractPresenterController">
		<property name="activeLectureController" ref="activeLectureController"/>
	</bean>
	
	<bean id="slideImageController" class="edu.uoregon.cs.presenter.web.controller.SlideImageController">
		<property name="dao" ref="dao"/>
		<property name="fileController" ref="fileController"/>
	</bean>
	
	<bean id="inkImageController" class="edu.uoregon.cs.presenter.web.controller.InkImageController">
		<property name="dao" ref="dao"/>
		<property name="fileController" ref="fileController"/>
	</bean>
	
	<bean id="whiteboardImageController" class="edu.uoregon.cs.presenter.web.controller.WhiteboardImageController">
		<property name="dao" ref="dao"/>
		<property name="fileController" ref="fileController"/>
	</bean>
	
	<bean id="createCourseController" class="edu.uoregon.cs.presenter.web.controller.instructor.CourseCreationController" parent="abstractPresenterController">
		<property name="formView" value="instructor/course/create"/>
		<property name="successView" value="redirect:/courses"/>
	</bean>
	
	<bean id="adminDashboardController" class="org.springframework.web.servlet.mvc.ParameterizableViewController">
		<property name="viewName" value="admin/default"/>
	</bean>
	
	<bean id="simpleAddRoleController" class="edu.uoregon.cs.presenter.web.controller.admin.SimpleAddRoleController" parent="abstractPresenterController">
		<property name="viewName" value="redirect:/admin/"/>
	</bean>
	
	<bean id="simpleRemoveRoleController" class="edu.uoregon.cs.presenter.web.controller.admin.SimpleRemoveRollController" parent="abstractPresenterController">
		<property name="viewName" value="redirect:/admin/"/>
	</bean>
	
	<bean id="upSoapServerController" class="org.codehaus.xfire.spring.remoting.XFireExporter">
		<property name="serviceFactory" ref="xfire.serviceFactory"/>
		<property name="xfire" ref="xfire"/>
		<property name="serviceBean" ref="ubiquitousPresenterService"/>
		<property name="serviceClass" value="edu.uoregon.cs.presenter.up.UbiquitousPresenterService"/>
		<property name="namespace" value="urn:testing"/>
		<property name="name" value="testing"/>
		
	</bean>
	
	<bean id="upHttpTransfersController" class="edu.uoregon.cs.presenter.up.HttpTransfers">
		<property name="dao" ref="dao"/>
		<property name="ubiquitousPresenterDao" ref="ubiquitousPresenterDao"/>
		<property name="fileController" ref="fileController"/>
	</bean>
	
	<bean id="staticController" class="org.springframework.web.servlet.mvc.ServletForwardingController">
		<property name="servletName" value="default"/>
	</bean>

	<!-- <bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
		<property name="prefix" value="/WEB-INF/jsp/"/>
		<property name="suffix" value=".jsp"/>
		<property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/>
	</bean> -->
	
	<bean id="viewResolver" class="org.ry1.springframework.web.view.SimpleViewResolver">
		<property name="defaultTemplate" value="template/default"/>
	</bean>
</beans>